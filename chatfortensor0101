-- Private RAGE Chat (Script users only)
-- Creator: tensor0101

local player = game:GetService("Players").LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Name = "PrivateRageChat"
gui.Parent = player:WaitForChild("PlayerGui")
gui.ResetOnSpawn = false

-- Сервисы
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

-- Создаём событие для приватного чата (если ещё не создано)
local chatEvent = ReplicatedStorage:FindFirstChild("PrivateRageChatEvent")
if not chatEvent then
    chatEvent = Instance.new("RemoteEvent")
    chatEvent.Name = "PrivateRageChatEvent"
    chatEvent.Parent = ReplicatedStorage
end

-- Звук
local sound = Instance.new("Sound")
sound.SoundId = "rbxasset://sounds/notification.mp3"
sound.Volume = 0.5
sound.Parent = gui

-- Настройки окна
local isMinimized = false
local originalSize = UDim2.new(0, 500, 0, 350)
local minimizedSize = UDim2.new(0, 500, 0, 40)

-- Основное окно
local frame = Instance.new("Frame")
frame.Size = originalSize
frame.Position = UDim2.new(0.5, -250, 0.5, -175)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BackgroundTransparency = 0.2
frame.Active = true
frame.Draggable = true
frame.Parent = gui

-- Закругление
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = frame

-- Заголовок
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
title.BackgroundTransparency = 0.3
title.Text = "  PRIVATE RAGE — tensor0101"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Font = Enum.Font.GothamSemibold
title.TextSize = 16
title.Parent = frame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = title

-- Кнопка закрытия
local close = Instance.new("TextButton")
close.Size = UDim2.new(0, 30, 0, 30)
close.Position = UDim2.new(1, -30, 0, 0)
close.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
close.BackgroundTransparency = 0.3
close.Text = "X"
close.TextColor3 = Color3.fromRGB(255, 255, 255)
close.TextSize = 18
close.Font = Enum.Font.GothamBold
close.Parent = frame
close.MouseButton1Click:Connect(function() gui:Destroy() end)

-- Кнопка сворачивания
local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -60, 0, 0)
minBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
minBtn.BackgroundTransparency = 0.3
minBtn.Text = "–"
minBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minBtn.TextSize = 18
minBtn.Font = Enum.Font.GothamBold
minBtn.Parent = frame
minBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    frame:TweenSize(isMinimized and minimizedSize or originalSize, "Out", "Quad", 0.3, true)
    chatBox.Visible = not isMinimized
    input.Visible = not isMinimized
    sendBtn.Visible = not isMinimized
end)

-- Область чата
local chatBox = Instance.new("ScrollingFrame")
chatBox.Size = UDim2.new(1, -10, 1, -80)
chatBox.Position = UDim2.new(0, 5, 0, 35)
chatBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
chatBox.BackgroundTransparency = 0.2
chatBox.BorderSizePixel = 0
chatBox.CanvasSize = UDim2.new(0, 0, 0, 0)
chatBox.ScrollBarThickness = 8
chatBox.Parent = frame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 5)
listLayout.Parent = chatBox
listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    chatBox.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y)
end)

-- Поле ввода
local input = Instance.new("TextBox")
input.Size = UDim2.new(0.7, -5, 0, 30)
input.Position = UDim2.new(0, 5, 1, -40)
input.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
input.BackgroundTransparency = 0.2
input.PlaceholderText = "Сообщение..."
input.Text = ""
input.TextColor3 = Color3.fromRGB(255, 255, 255)
input.TextSize = 14
input.Font = Enum.Font.Gotham
input.ClearTextOnFocus = false
input.Parent = frame
Instance.new("UICorner", input).CornerRadius = UDim.new(0, 6)

-- Кнопка отправки
local sendBtn = Instance.new("TextButton")
sendBtn.Size = UDim2.new(0.3, -10, 0, 30)
sendBtn.Position = UDim2.new(0.7, 0, 1, -40)
sendBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
sendBtn.BackgroundTransparency = 0.2
sendBtn.Text = "Отправить"
sendBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
sendBtn.TextSize = 14
sendBtn.Font = Enum.Font.GothamSemibold
sendBtn.Parent = frame
Instance.new("UICorner", sendBtn).CornerRadius = UDim.new(0, 6)

-- Функция добавления сообщения
local function addMessage(text, isOwn)
    local msg = Instance.new("TextLabel")
    msg.Size = UDim2.new(1, -10, 0, 20)
    msg.BackgroundTransparency = 1
    msg.Text = text
    msg.TextColor3 = Color3.fromRGB(255, 255, 255)
    msg.TextSize = 14
    msg.Font = Enum.Font.Gotham
    msg.TextXAlignment = Enum.TextXAlignment.Left
    msg.Parent = chatBox
end

-- Уведомление
local function notify(sender, text)
    local n = Instance.new("Frame")
    n.Size = UDim2.new(0, 250, 0, 60)
    n.Position = UDim2.new(1, -260, 1, -80)
    n.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    n.BackgroundTransparency = 0.3
    n.Parent = gui
    Instance.new("UICorner", n).CornerRadius = UDim.new(0, 8)

    local nt = Instance.new("TextLabel")
    nt.Size = UDim2.new(1, -10, 1, -10)
    nt.Position = UDim2.new(0, 5, 0, 5)
    nt.BackgroundTransparency = 1
    nt.Text = sender .. ": " .. text
    nt.TextColor3 = Color3.fromRGB(255, 255, 255)
    nt.TextSize = 14
    nt.Font = Enum.Font.Gotham
    nt.TextWrapped = true
    nt.TextXAlignment = Enum.TextXAlignment.Left
    nt.Parent = n

    wait(3)
    n:Destroy()
end

-- Отправка сообщения всем, у кого есть скрипт
local function sendPrivateMessage()
    local text = input.Text
    if text ~= "" then
        -- Отправляем через RemoteEvent
        chatEvent:FireServer(text)
        
        -- Показываем у себя
        addMessage(player.Name .. ": " .. text)
        notify(player.Name, text)
        sound:Play()
        input.Text = ""
    end
end

sendBtn.MouseButton1Click:Connect(sendPrivateMessage)
input.FocusLost:Connect(function(enter) if enter then sendPrivateMessage() end end)

-- Приём сообщений
chatEvent.OnClientEvent:Connect(function(sender, message)
    if sender ~= player then
        addMessage(sender.Name .. ": " .. message)
        notify(sender.Name, message)
        sound:Play()
    end
end)

-- Серверная часть (скрипт должен быть и на сервере для ретрансляции)
local function setupServer()
    if not game:GetService("RunService"):IsClient() then
        local event = ReplicatedStorage:FindFirstChild("PrivateRageChatEvent")
        if event then
            event.OnServerEvent:Connect(function(plr, message)
                -- Рассылаем всем игрокам
                for _, p in ipairs(game:GetService("Players"):GetPlayers()) do
                    if p ~= plr then
                        event:FireClient(p, plr, message)
                    end
                end
            end)
        end
    end
end
coroutine.wrap(setupServer)()

addMessage("Приватный чат активирован. Видят только те, у кого есть скрипт.")
