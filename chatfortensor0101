-- RAGE Chat for Arceus X (uses Roblox Chat)
-- Creator: tensor0101

local player = game:GetService("Players").LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Name = "RageChatArceus"
gui.Parent = player:WaitForChild("PlayerGui")
gui.ResetOnSpawn = false

-- Сервисы
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- Звук
local sound = Instance.new("Sound")
sound.SoundId = "rbxasset://sounds/notification.mp3"
sound.Volume = 0.5
sound.Parent = gui

-- Настройки окна
local isMinimized = false
local originalSize = UDim2.new(0, 500, 0, 350)
local minimizedSize = UDim2.new(0, 500, 0, 40)

-- Основное окно
local frame = Instance.new("Frame")
frame.Size = originalSize
frame.Position = UDim2.new(0.5, -250, 0.5, -175)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BackgroundTransparency = 0.2
frame.Active = true
frame.Draggable = true
frame.Parent = gui

-- Закругление
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = frame

-- Заголовок
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
title.BackgroundTransparency = 0.3
title.Text = "  RAGE Chat (Arceus) — tensor0101"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Font = Enum.Font.GothamSemibold
title.TextSize = 16
title.Parent = frame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = title

-- Кнопка закрытия
local close = Instance.new("TextButton")
close.Size = UDim2.new(0, 30, 0, 30)
close.Position = UDim2.new(1, -30, 0, 0)
close.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
close.BackgroundTransparency = 0.3
close.Text = "X"
close.TextColor3 = Color3.fromRGB(255, 255, 255)
close.TextSize = 18
close.Font = Enum.Font.GothamBold
close.Parent = frame
close.MouseButton1Click:Connect(function() gui:Destroy() end)

-- Кнопка сворачивания/разворачивания
local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -60, 0, 0)
minBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
minBtn.BackgroundTransparency = 0.3
minBtn.Text = "–"
minBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minBtn.TextSize = 18
minBtn.Font = Enum.Font.GothamBold
minBtn.Parent = frame

minBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        frame:TweenSize(minimizedSize, "Out", "Quad", 0.3, true)
        minBtn.Text = "□"
        chatBox.Visible = false
        input.Visible = false
        sendBtn.Visible = false
    else
        frame:TweenSize(originalSize, "Out", "Quad", 0.3, true)
        minBtn.Text = "–"
        chatBox.Visible = true
        input.Visible = true
        sendBtn.Visible = true
    end
end)

-- Область чата
local chatBox = Instance.new("ScrollingFrame")
chatBox.Size = UDim2.new(1, -10, 1, -80)
chatBox.Position = UDim2.new(0, 5, 0, 35)
chatBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
chatBox.BackgroundTransparency = 0.2
chatBox.BorderSizePixel = 0
chatBox.CanvasSize = UDim2.new(0, 0, 0, 0)
chatBox.ScrollBarThickness = 8
chatBox.Parent = frame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 5)
listLayout.Parent = chatBox
listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    chatBox.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y)
end)

-- Поле ввода
local input = Instance.new("TextBox")
input.Size = UDim2.new(0.7, -5, 0, 30)
input.Position = UDim2.new(0, 5, 1, -40)
input.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
input.BackgroundTransparency = 0.2
input.PlaceholderText = "Сообщение..."
input.Text = ""
input.TextColor3 = Color3.fromRGB(255, 255, 255)
input.TextSize = 14
input.Font = Enum.Font.Gotham
input.ClearTextOnFocus = false
input.Parent = frame
Instance.new("UICorner", input).CornerRadius = UDim.new(0, 6)

-- Кнопка отправки
local sendBtn = Instance.new("TextButton")
sendBtn.Size = UDim2.new(0.3, -10, 0, 30)
sendBtn.Position = UDim2.new(0.7, 0, 1, -40)
sendBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
sendBtn.BackgroundTransparency = 0.2
sendBtn.Text = "Отправить"
sendBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
sendBtn.TextSize = 14
sendBtn.Font = Enum.Font.GothamSemibold
sendBtn.Parent = frame
Instance.new("UICorner", sendBtn).CornerRadius = UDim.new(0, 6)

-- Функция добавления сообщения в локальный список
local function addMessage(text)
    local msg = Instance.new("TextLabel")
    msg.Size = UDim2.new(1, -10, 0, 20)
    msg.BackgroundTransparency = 1
    msg.Text = text
    msg.TextColor3 = Color3.fromRGB(255, 255, 255)
    msg.TextSize = 14
    msg.Font = Enum.Font.Gotham
    msg.TextXAlignment = Enum.TextXAlignment.Left
    msg.Parent = chatBox
end

-- Уведомление
local function notify(sender, text)
    local n = Instance.new("Frame")
    n.Size = UDim2.new(0, 250, 0, 60)
    n.Position = UDim2.new(1, -260, 1, -80)
    n.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    n.BackgroundTransparency = 0.3
    n.Parent = gui
    Instance.new("UICorner", n).CornerRadius = UDim.new(0, 8)

    local nt = Instance.new("TextLabel")
    nt.Size = UDim2.new(1, -10, 1, -10)
    nt.Position = UDim2.new(0, 5, 0, 5)
    nt.BackgroundTransparency = 1
    nt.Text = sender .. ": " .. text
    nt.TextColor3 = Color3.fromRGB(255, 255, 255)
    nt.TextSize = 14
    nt.Font = Enum.Font.Gotham
    nt.TextWrapped = true
    nt.TextXAlignment = Enum.TextXAlignment.Left
    nt.Parent = n

    wait(3)
    n:Destroy()
end

-- Отправка сообщения в стандартный чат Roblox
local function sendPublicMessage()
    local text = input.Text
    if text ~= "" then
        -- Отправляем через стандартный механизм
        local sayRequest = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents") and
                           ReplicatedStorage.DefaultChatSystemChatEvents:FindFirstChild("SayMessageRequest")
        if sayRequest then
            sayRequest:FireServer(text, "All")
        else
            -- Fallback для старых игр
            game:GetService("ReplicatedStorage"):WaitForChild("Chat"):FireServer(text)
        end
        
        -- Показываем у себя
        addMessage(player.Name .. ": " .. text)
        notify(player.Name, text)
        sound:Play()
        input.Text = ""
    end
end

sendBtn.MouseButton1Click:Connect(sendPublicMessage)
input.FocusLost:Connect(function(enter) if enter then sendPublicMessage() end end)

-- Приём сообщений от других игроков
local function onPlayerChat(plr, message)
    if plr ~= player then
        addMessage(plr.Name .. ": " .. message)
        notify(plr.Name, message)
        sound:Play()
    end
end

-- Подключаемся к событию Chatted для всех игроков
for _, plr in ipairs(game:GetService("Players"):GetPlayers()) do
    if plr ~= player then
        plr.Chatted:Connect(function(msg) onPlayerChat(plr, msg) end)
    end
end

game:GetService("Players").PlayerAdded:Connect(function(plr)
    plr.Chatted:Connect(function(msg) onPlayerChat(plr, msg) end)
end)

addMessage("Чат для Arceus X запущен. Сообщения видят все в обычном чате.")
